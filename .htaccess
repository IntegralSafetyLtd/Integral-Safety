# Integral Safety - URL Rewriting and Security
# Apache/LiteSpeed Configuration

# Enable Rewrite Engine
RewriteEngine On

# Force HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Remove www (optional - uncomment if needed)
# RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
# RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

# Prevent directory browsing
Options -Indexes

# Block access to sensitive files
<FilesMatch "^(config\.php|\.env|\.htaccess|database_schema\.sql)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Protect uploads directory from PHP execution
<Directory "uploads">
    <FilesMatch "\.php$">
        Order allow,deny
        Deny from all
    </FilesMatch>
</Directory>

# Protect content directory
<Directory "content">
    Order allow,deny
    Deny from all
</Directory>

# Clean URLs - Services
RewriteRule ^services/?$ services.php [L,QSA]
RewriteRule ^services/([a-z0-9-]+)/?$ service.php?slug=$1 [L,QSA]

# Clean URLs - Training
RewriteRule ^training/?$ training.php [L,QSA]
RewriteRule ^training/([a-z0-9-]+)/?$ training-single.php?slug=$1 [L,QSA]

# Clean URLs - Static Pages
RewriteRule ^about/?$ about.php [L,QSA]
RewriteRule ^contact/?$ contact.php [L,QSA]
RewriteRule ^privacy/?$ privacy.php [L,QSA]
RewriteRule ^terms/?$ terms.php [L,QSA]

# Admin area (no rewriting needed, direct access)
# /admin/ works as-is

# Handle 404 errors
ErrorDocument 404 /404.php

# Caching for static assets
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/webp "access plus 1 month"
    ExpiresByType text/css "access plus 1 week"
    ExpiresByType application/javascript "access plus 1 week"
    ExpiresByType image/x-icon "access plus 1 year"
</IfModule>

# Gzip compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript application/json
</IfModule>

# Security Headers
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>
